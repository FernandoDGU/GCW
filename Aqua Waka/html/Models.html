<!DOCTYPE html>
<html>
<head>
	<title>Modelos</title>
	<script type="text/javascript" src="js/libs/jquery/jquery-2.1.4.min.js"></script>
	<script type="text/javascript" src="js/libs/three/three.js"></script>
	<script type="text/javascript" src="js/libs/three/MTLLoader.js"></script>
	<script type="text/javascript" src="js/libs/three/OBJLoader.js"></script>

	<script type="text/javascript">
		
		var scene, camera, renderer; 
		var controls, clock, deltaTime;
		var objects = [];
		var keys = {};
		var objectMov; 
		var cube;
		var isWorldReady = [false, false];

		$(document).ready(function(){

			setupScene();

			loadOBJWithMTL("assets/", "Octopus.obj", "Octopus.mtl", (object) => {

				object.position.z = -10;

				object.position.y = 5;
				object.rotation.y = THREE.Math.degToRad(-90);

				scene.add(object);
				isWorldReady[0] = true;
			});


			loadOBJWithMTL("assets/", "Pez_Globo.obj", "Pez_Globo.mtl", (object) => {

				// object.position.z = -10;
				// object.position.x = -10;


				object.position.y = 5;
				object.rotation.y = THREE.Math.degToRad(-90);
				objectMov = object;
				cube.add(object);
				isWorldReady[1] = true;
			});
			render();
			document.addEventListener('keydown', onKeyDown);
			document.addEventListener('keyup', onKeyUp);	

		});


		function loadOBJWithMTL(path, objFile, mtlFile, onLoadCallback) {
			var mtlLoader = new THREE.MTLLoader();
			mtlLoader.setPath(path);
			mtlLoader.load(mtlFile, (materials) => {
				
				var objLoader = new THREE.OBJLoader();
				objLoader.setMaterials(materials);
				objLoader.setPath(path);
				objLoader.load(objFile, (object) => {
					onLoadCallback(object);
				});

			});
		}	

		function onKeyDown(event) {
			keys[String.fromCharCode(event.keyCode)] = true;
		}
		function onKeyUp(event) {
			keys[String.fromCharCode(event.keyCode)] = false;
		}

		function render(){
			requestAnimationFrame(render);
			deltaTime = clock.getDelta();	

			var yaw = 0;
			var forward = 0;
			if (keys["A"]) {
				yaw = 5;
			} else if (keys["D"]) {
				yaw = -5;
			}
			if (keys["W"]) {
				forward = -20;
			} else if (keys["S"]) {
				forward = 20;
			}

			if (isWorldReady[0] && isWorldReady[1]) {
				
				// camera.rotation.y += yaw * deltaTime;
				// camera.translateZ(forward * deltaTime);
			}
			
			cube.rotation.y += yaw * deltaTime; 
			cube.translateZ( forward * deltaTime);

			// objectMov.rotation.y += yaw * deltaTime;
			// objectMov.translateZ(forward * deltaTime);
			
			renderer.render(scene, camera);
			// camera.lookAt(objectMov.position);

		}

		function setupScene() {		
			var visibleSize = { width: 800, height: 500};
			clock = new THREE.Clock();		
			scene = new THREE.Scene();
			camera = new THREE.PerspectiveCamera(75, visibleSize.width / visibleSize.height, 0.1, 100);
			camera.position.z = 0;
			// camera.position.y = 5;

			renderer = new THREE.WebGLRenderer( {precision: "mediump" } );
			renderer.setClearColor(new THREE.Color(0, 1, .9));
			renderer.setPixelRatio(visibleSize.width / visibleSize.height);
			renderer.setSize(visibleSize.width, visibleSize.height);

			var ambientLight = new THREE.AmbientLight(new THREE.Color(1, 1, 1), 1.0);
			scene.add(ambientLight);

			var directionalLight = new THREE.DirectionalLight(new THREE.Color(1, 1, 0), 0.4);
			directionalLight.position.set(0, 0, 1);
			scene.add(directionalLight);

			var grid = new THREE.GridHelper(50, 10, 0xffffff, 0xffffff);
			grid.position.y = -1;
			scene.add(grid);

			var material = new THREE.MeshLambertMaterial({color: new THREE.Color(0, 0.0, 0.0)});
			var geometry = new THREE.BoxGeometry(1, 1, 1);
			cube = new THREE.Mesh(geometry, material)
			cube.position.y = 2;
			scene.add(cube);

			camera.position.y = 50;
			camera.position.z = 50;
			// camera.rotation.y = THREE.Math.degToRad(-45);
			camera.rotation.x = THREE.Math.degToRad(-45);
			$("#scene-section").append(renderer.domElement);
		}



	</script>

</head>



<body>

	<div id="scene-section"></div>

</body>
</html>