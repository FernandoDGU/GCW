<!DOCTYPE html>
<html>
<head>
	<title>Modelos</title>
	<script type="text/javascript" src="js/libs/jquery/jquery-2.1.4.min.js"></script>
	<script type="text/javascript" src="js/libs/three/three.js"></script>
	<script type="text/javascript" src="js/libs/three/MTLLoader.js"></script>
	<script type="text/javascript" src="js/libs/three/OBJLoader.js"></script>

	<script type="text/javascript">
		
		var scene, camera, renderer; 
		var controls, clock, deltaTime;
		var objects = [];
		var keys = {};
		var objectMov; 
		var cube, cube2;
		var isWorldReady = [false, false];

		$(document).ready(function(){

			setupScene();

			loadOBJWithMTL("assets/Island/", "Island.obj", "Island.mtl", (object) => {

				object.position.z = -30;

				object.position.y = 0;
				// object.rotation.y = THREE.Math.degToRad(-90);
				object.scale.x = 4.0;
				object.scale.y = 3.5;
				object.scale.z = 4.0;

				object.rotation.y = THREE.Math.degToRad(90);

				// cube.add(object);
				scene.add(object);
				isWorldReady[0] = true;
			});


			loadOBJWithMTL("assets/", "Pira.obj", "Pira.mtl", (object) => {

				// object.position.z = -10;
				// object.position.x = -10;

				object.scale.x = 0.8;
				object.scale.y = 0.8;
				object.scale.z = 0.8;

				object.position.y = 5;
				object.rotation.y = THREE.Math.degToRad(-90);
				objectMov = object;
				scene.add(object);
				// scene.add(object);
				isWorldReady[1] = true;
			});

			loadOBJWithMTL("assets/", "KO_Hammer_Brawl.obj", "KO_Hammer_Brawl.mtl", (object) => {

				object.scale.x = 0.4;
				object.scale.y = 0.4;
				object.scale.z = 0.4;

				cube.add(object);

			});

            loadOBJWithMTL("assets/", "KO_Hammer_Brawl2.obj", "KO_Hammer_Brawl2.mtl", (object) => {
				
				object.scale.x = 0.4;
				object.scale.y = 0.4;
				object.scale.z = 0.4;

				cube2.add(object);
				

			});
			
			render();
			document.addEventListener('keydown', onKeyDown);
			document.addEventListener('keyup', onKeyUp);	


			// createSkydome();
			var skyDom = new THREE.SphereGeometry(166, 25 ,25);
			var loader = new THREE.TextureLoader(),
			texture = loader.load("../sources/Skydome02.jpg");
			var material = new THREE.MeshPhongMaterial({ 
        	map: texture,
			});
			var sky = new THREE.Mesh(skyDom, material);
    		sky.material.side = THREE.BackSide;
            sky.position.z = 40;
            sky.position.y = 4;
    		scene.add(sky);

		});


		function loadOBJWithMTL(path, objFile, mtlFile, onLoadCallback) {
			var mtlLoader = new THREE.MTLLoader();
			mtlLoader.setPath(path);
			mtlLoader.load(mtlFile, (materials) => {
				
				var objLoader = new THREE.OBJLoader();
				objLoader.setMaterials(materials);
				objLoader.setPath(path);
				objLoader.load(objFile, (object) => {
					onLoadCallback(object);
				});

			});
		}	

		function onKeyDown(event) {
			keys[String.fromCharCode(event.keyCode)] = true;
		}
		function onKeyUp(event) {
			keys[String.fromCharCode(event.keyCode)] = false;
		}

		function render(){
			requestAnimationFrame(render);
			deltaTime = clock.getDelta();	

			var yaw = 0, yaw2 = 0;
			var forward = 0, forward2 = 0;

			if (keys["A"]) {
				yaw = -20;
			} else if (keys["D"]) {
				yaw = 20;
			}
			if (keys["W"]) {
				forward = -20;
			} else if (keys["S"]) {
				forward = 20;
			}

			if(keys["X"]){
				cube.rotation.x = THREE.Math.degToRad(-90);
				yaw = 0;
				forward = 0;
				
			}else {
				
				cube.rotation.x = THREE.Math.degToRad(0);
			}

            //Segundo martillo

            
			if (keys["J"]) {
				yaw2 = -20;
			} else if (keys["L"]) {
				yaw2 = 20;
			}
			if (keys["I"]) {
				forward2 = -20;
			} else if (keys["K"]) {
				forward2 = 20;
			}

			if(keys["N"]){
				cube2.rotation.x = THREE.Math.degToRad(-90);
				yaw2 = 0;
				forward2 = 0;
				
			}else {
				
				cube2.rotation.x = THREE.Math.degToRad(0);
			}


			if (isWorldReady[0] && isWorldReady[1]) {
				
				// camera.rotation.y += yaw * deltaTime;
				// camera.translateZ(forward * deltaTime);
                cube.translateZ( forward * deltaTime);
			    cube.translateX(yaw * deltaTime);
                cube2.translateZ( forward2 * deltaTime);
			    cube2.translateX(yaw2 * deltaTime);
			}
			
			// cube.rotation.y += yaw * deltaTime; 
			
			
			renderer.render(scene, camera);
			// camera.lookAt(objectMov.position);

		}

		function setupScene() {		
			var visibleSize = { width: 800, height: 400};
			clock = new THREE.Clock();		
			scene = new THREE.Scene();
			camera = new THREE.PerspectiveCamera(75, visibleSize.width / visibleSize.height, 0.1, 200);
			camera.position.z = 0;
			// camera.position.y = 5;

			renderer = new THREE.WebGLRenderer( {precision: "mediump" } );
			renderer.setClearColor(new THREE.Color(0, 1, .9));
			renderer.setPixelRatio(visibleSize.width / visibleSize.height);
			renderer.setSize(visibleSize.width, visibleSize.height);

			var ambientLight = new THREE.AmbientLight(new THREE.Color(1, 1, 1), 1.0);
			scene.add(ambientLight);

			var directionalLight = new THREE.DirectionalLight(new THREE.Color(1, 1, 0), 0.4);
			directionalLight.position.set(0, 0, 1);
			scene.add(directionalLight);

			var grid = new THREE.GridHelper(50, 10, 0xffffff, 0xffffff);
			grid.position.y = -1;
			scene.add(grid);

			var material = new THREE.MeshPhongMaterial({
				color: new THREE.Color(0.1, 1.0, 0.0),
				opacity: .0,
				transparent: true,
			});
			var geometry = new THREE.BoxGeometry(1, 1, 1);
			cube = new THREE.Mesh(geometry, material)
			cube.position.y = 2;
            cube.position.x = -20;
			cube.position.z = 20;
			scene.add(cube);

            cube2 = new THREE.Mesh(geometry, material);
			cube2.position.y = 2;
            
			// cube2 = cube.clone();
			cube2.position.x = 20;
			cube2.position.z = 20;


            scene.add(cube2);
			camera.position.y = 30;
			camera.position.z = 60;
			// camera.rotation.y = THREE.Math.degToRad(-45);
			camera.rotation.x = THREE.Math.degToRad(-38);  //cambio a 38
			$("#scene-section").append(renderer.domElement);
		}

		function createSkydome(){
			
		}

	</script>

</head>



<body>

	<div id="scene-section"></div>
    <div>Hola</div>

</body>
</html>